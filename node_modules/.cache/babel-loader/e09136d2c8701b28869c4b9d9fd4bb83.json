{"ast":null,"code":"import { Base } from './Base.js';\nimport { Number as NumberT } from './Number.js';\nimport * as utils from './utils.js';\n\nclass ArrayT extends Base {\n  constructor(type, length) {\n    let lengthType = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 'count';\n    super();\n    this.type = type;\n    this.length = length;\n    this.lengthType = lengthType;\n  }\n\n  decode(stream, parent) {\n    let length;\n    const {\n      pos\n    } = stream;\n    const res = [];\n    let ctx = parent;\n\n    if (this.length != null) {\n      length = utils.resolveLength(this.length, stream, parent);\n    }\n\n    if (this.length instanceof NumberT) {\n      // define hidden properties\n      Object.defineProperties(res, {\n        parent: {\n          value: parent\n        },\n        _startOffset: {\n          value: pos\n        },\n        _currentOffset: {\n          value: 0,\n          writable: true\n        },\n        _length: {\n          value: length\n        }\n      });\n      ctx = res;\n    }\n\n    if (length == null || this.lengthType === 'bytes') {\n      const target = length != null ? stream.pos + length : (parent != null ? parent._length : undefined) ? parent._startOffset + parent._length : stream.length;\n\n      while (stream.pos < target) {\n        res.push(this.type.decode(stream, ctx));\n      }\n    } else {\n      for (let i = 0, end = length; i < end; i++) {\n        res.push(this.type.decode(stream, ctx));\n      }\n    }\n\n    return res;\n  }\n\n  size(array, ctx) {\n    let includePointers = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : true;\n\n    if (!array) {\n      return this.type.size(null, ctx) * utils.resolveLength(this.length, null, ctx);\n    }\n\n    let size = 0;\n\n    if (this.length instanceof NumberT) {\n      size += this.length.size();\n      ctx = {\n        parent: ctx,\n        pointerSize: 0\n      };\n    }\n\n    for (let item of array) {\n      size += this.type.size(item, ctx);\n    }\n\n    if (ctx && includePointers && this.length instanceof NumberT) {\n      size += ctx.pointerSize;\n    }\n\n    return size;\n  }\n\n  encode(stream, array, parent) {\n    let ctx = parent;\n\n    if (this.length instanceof NumberT) {\n      ctx = {\n        pointers: [],\n        startOffset: stream.pos,\n        parent\n      };\n      ctx.pointerOffset = stream.pos + this.size(array, ctx, false);\n      this.length.encode(stream, array.length);\n    }\n\n    for (let item of array) {\n      this.type.encode(stream, item, ctx);\n    }\n\n    if (this.length instanceof NumberT) {\n      let i = 0;\n\n      while (i < ctx.pointers.length) {\n        const ptr = ctx.pointers[i++];\n        ptr.type.encode(stream, ptr.val, ptr.parent);\n      }\n    }\n  }\n\n}\n\nexport { ArrayT as Array };","map":{"version":3,"sources":["C:/Users/PC/Documents/PROGRAMMING/MERN/frontend/node_modules/restructure/src/Array.js"],"names":["Base","Number","NumberT","utils","ArrayT","constructor","type","length","lengthType","decode","stream","parent","pos","res","ctx","resolveLength","Object","defineProperties","value","_startOffset","_currentOffset","writable","_length","target","undefined","push","i","end","size","array","includePointers","pointerSize","item","encode","pointers","startOffset","pointerOffset","ptr","val","Array"],"mappings":"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","sourcesContent":["import {Base} from './Base.js';\nimport {Number as NumberT} from './Number.js';\nimport * as utils from './utils.js';\n\nclass ArrayT extends Base {\n  constructor(type, length, lengthType = 'count') {\n    super();\n    this.type = type;\n    this.length = length;\n    this.lengthType = lengthType;\n  }\n\n  decode(stream, parent) {\n    let length;\n    const { pos } = stream;\n\n    const res = [];\n    let ctx = parent;\n\n    if (this.length != null) {\n      length = utils.resolveLength(this.length, stream, parent);\n    }\n\n    if (this.length instanceof NumberT) {\n      // define hidden properties\n      Object.defineProperties(res, {\n        parent:         { value: parent },\n        _startOffset:   { value: pos },\n        _currentOffset: { value: 0, writable: true },\n        _length:        { value: length }\n      });\n\n      ctx = res;\n    }\n\n    if ((length == null) || (this.lengthType === 'bytes')) {\n      const target = (length != null) ?\n        stream.pos + length\n      : (parent != null ? parent._length : undefined) ?\n        parent._startOffset + parent._length\n      :\n        stream.length;\n\n      while (stream.pos < target) {\n        res.push(this.type.decode(stream, ctx));\n      }\n\n    } else {\n      for (let i = 0, end = length; i < end; i++) {\n        res.push(this.type.decode(stream, ctx));\n      }\n    }\n\n    return res;\n  }\n\n  size(array, ctx, includePointers = true) {\n    if (!array) {\n      return this.type.size(null, ctx) * utils.resolveLength(this.length, null, ctx);\n    }\n\n    let size = 0;\n    if (this.length instanceof NumberT) {\n      size += this.length.size();\n      ctx = {parent: ctx, pointerSize: 0};\n    }\n\n    for (let item of array) {\n      size += this.type.size(item, ctx);\n    }\n\n    if (ctx && includePointers && this.length instanceof NumberT) {\n      size += ctx.pointerSize;\n    }\n    \n    return size;\n  }\n\n  encode(stream, array, parent) {\n    let ctx = parent;\n    if (this.length instanceof NumberT) {\n      ctx = {\n        pointers: [],\n        startOffset: stream.pos,\n        parent\n      };\n\n      ctx.pointerOffset = stream.pos + this.size(array, ctx, false);\n      this.length.encode(stream, array.length);\n    }\n\n    for (let item of array) {\n      this.type.encode(stream, item, ctx);\n    }\n\n    if (this.length instanceof NumberT) {\n      let i = 0;\n      while (i < ctx.pointers.length) {\n        const ptr = ctx.pointers[i++];\n        ptr.type.encode(stream, ptr.val, ptr.parent);\n      }\n    }\n  }\n}\n\nexport {ArrayT as Array};\n"]},"metadata":{},"sourceType":"module"}